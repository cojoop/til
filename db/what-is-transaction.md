# 트랜잭션(Transaction)이란

트랜잭션은 `DB의 상태를 변경시키기 위해 수행하는 작업 단위`로 여러 SQL 명령을 하나의 트랜잭션으로 묶어 처리하며, 트랜잭션이 성공적으로 완료되면 데이터베이스에 작업 결과가 반영되고, 실패하면 이전 상태로 되돌릴 수 있습니다.

- 트랜잭션은 데이터베이스의 상태를 일관되게 유지하고, 다양한 장애 상황에서도 데이터의 무결성을 보장하는 데 사용됩니다.

## 트랜잭션의 주요 기능

트랜잭션을 효과적으로 관리하기 위해 데이터베이스에서는 여러 가지 기능을 제공합니다.

 1. **BEGIN TRANSACTION:** 트랜잭션을 시작합니다.
 2. **COMMIT:** 트랜잭션 내의 모든 작업을 확정하여 데이터베이스에 반영합니다.
 3. **ROLLBACK:** 트랜잭션 내에서 발생한 모든 변경을 취소하고, 데이터베이스를 이전 상태로 되돌립니다.
 4. **SAVEPOINT:** 트랜잭션 내에서 특정 지점을 저장하여 나중에 해당 지점으로 롤백할 수 있습니다.

> 쿼리문을 실행하고 DB에 결과를 반영하려면 커밋 명령어인 `commit` 을 호출하고, 결과를 반영하고 싶지 않으면 롤백 명령어인 `rollback` 을 호출하면 됩니다.

## DB 세션

DB 세션은 데이터베이스 서버와 클라이언트 애플리케이션 간의 연결을 의미합니다. 세션이 시작되면 사용자는 데이터베이스에 접속하여 SQL 명령을 실행할 수 있습니다.

- 각 세션은 고유한 상태를 유지하며, 트랜잭션이 세션 내에서 실행됩니다.

#### DB 세션의 주요 역할

- 세션 상태 관리: 각 세션은 트랜잭션 상태, 격리 수준, 그리고 커밋 또는 롤백 상태를 포함한 고유한 상태를 유지합니다.
- 연결 관리: 세션은 데이터베이스와의 연결을 유지하며, SQL 명령을 전송하고 결과를 받아오는 역할을 합니다.
- 자원 관리: 세션이 종료되면 데이터베이스 자원이 반환됩니다. 이 과정을 통해 데이터베이스 성능을 관리합니다.

> 사용자가 데이터베이스에 접속하면 세션이 생성되고, 이 세션 내에서 트랜잭션이 실행됩니다. 각 세션에서 실행되는 트랜잭션은 독립적이며, 세션 종료 시 커밋되지 않은 트랜잭션은 자동으로 롤백됩니다.

## 자동 커밋과 수동 커밋

트랜잭션을 관리하는 방법에는 자동 커밋과 수동 커밋이라는 두 가지 모드가 있습니다.

### 자동 커밋(Autocommit)

자동 커밋 모드는 SQL 명령이 실행될 때마다 그 결과가 즉시 데이터베이스에 반영되는 방식입니다. 기본적으로 대부분의 데이터베이스 시스템이 자동 커밋 모드를 사용합니다.

- 장점: 사용하기 간편하며, 작업이 즉시 완료됩니다.
- 단점: 여러 작업을 논리적으로 묶기 어려워 데이터 무결성에 위험을 초래할 수 있습니다.

### 수동 커밋(Manual Commit)

수동 커밋 모드는 트랜잭션을 명시적으로 시작하고, 모든 작업이 성공적으로 완료된 후 개발자가 직접 커밋을 호출하여 데이터베이스에 반영하는 방식입니다.

- 장점: 여러 작업을 하나의 트랜잭션으로 묶어 처리할 수 있어 데이터 무결성을 쉽게 유지할 수 있습니다.
- 단점: 코드가 복잡해질 수 있으며, 작업 완료가 지연될 수 있습니다.

> `commit`, `rollback`을 직접 호출하면서 트랜잭션 기능을 제대로 수행하려면 자동 커밋을 끄고 수동 커밋을 사용해야 합니다.

## 트랜잭션의 ACID 특성

 1. 원자성(Atomicity): 트랜잭션의 모든 작업이 완벽히 수행되거나, 전혀 수행되지 않아야 합니다. 작업 중 일부만 수행되거나 실패하는 상황은 허용되지 않습니다.

 2. 일관성(Consistency): 트랜잭션 전후에 데이터베이스의 상태는 항상 일관성을 유지해야 합니다. 모든 작업이 수행된 후에도 데이터베이스의 제약 조건이 충족되어야 합니다.

 3. 고립성(Isolation): 동시에 실행되는 트랜잭션은 서로 간섭하지 않고 독립적으로 실행되어야 합니다. 이는 트랜잭션이 격리된 상태에서 실행됨을 보장합니다.

 4. 지속성(Durability): 트랜잭션이 성공적으로 완료된 후에는 그 결과가 영구적으로 데이터베이스에 반영되어야 합니다.
