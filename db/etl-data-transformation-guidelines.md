# ETL 데이터 변환 주의사항

서로 다른 데이터베이스(DB)에서 동일한 구조의 테이블로 데이터를 ETL(추출, 변환, 적재) 과정으로 옮길 때 주의해야 할 몇 가지 사항은 다음과 같습니다.

### 1. 데이터 타입 호환성

- 서로 다른 DBMS에서는 같은 데이터 타입이라도 세부적인 차이가 있을 수 있습니다. 예를 들어, VARCHAR나 TEXT와 같은 문자열 데이터 타입이 DB마다 최대 크기나 저장 방식에 차이가 있을 수 있습니다.
- 날짜 및 시간(DATE, DATETIME, TIMESTAMP) 형식도 다를 수 있기 때문에, 이를 정확하게 맞추는 변환 로직이 필요합니다.
- `Tibero`와 같은 일부 DB에서는 숫자 데이터 타입이나 특수한 데이터 표현 방식이 다른 DB와 차이가 있을 수 있습니다. 이를 변환할 때 데이터 유실이나 손상이 발생하지 않도록 주의해야 합니다.

### 2. NULL 및 기본값 처리

- 한 DB에서 NULL로 처리되는 값이 다른 DB에서는 DEFAULT 값으로 설정되거나 오류를 일으킬 수 있습니다. 필드가 NOT NULL로 설정된 경우, 데이터가 비어 있는지 또는 기본값을 넣어야 하는지 확인이 필요합니다.

### 3. 인코딩 문제

- DB마다 문자 인코딩 방식이 다를 수 있습니다. 예를 들어, 소스 DB가 `UTF-8`로 설정되어 있고 대상 DB가 `ISO-8859-1`이면, 문자 데이터가 손상될 수 있습니다. 반드시 두 DB 간의 인코딩 방식이 동일하거나 변환 과정에서 적절한 처리를 해야 합니다.

### 4. 키 제약 조건

- 기본 키, 외래 키, 유니크 키 등의 제약 조건이 DB마다 다르게 동작할 수 있습니다. 예를 들어, 한 DB에서는 중복된 기본 키를 허용하지 않지만 다른 DB에서는 허용할 수 있으므로 이 부분을 정확히 맞추어야 합니다.
- 외래 키가 있는 경우 관련된 참조 무결성도 변환 과정에서 유지되도록 해야 합니다.

### 5. 트랜잭션 및 락 처리

- 트랜잭션 처리 방식이나 잠금(locking) 메커니즘이 DB마다 다를 수 있습니다. 대량의 데이터를 한 번에 적재할 때, 대상 DB의 트랜잭션 크기나 락 제한에 따라 성능 저하나 트랜잭션 실패가 발생할 수 있습니다.
- `Tibero`와 같은 DB는 자체적인 트랜잭션 관리 방식이 있으므로, 트랜잭션 경계 설정이나 커밋/롤백 로직이 정확히 동작하도록 주의해야 합니다.

### 6. 인덱스 및 성능 고려

- 대상 DB에 데이터를 적재하기 전에 인덱스가 미리 생성되어 있다면 대량 데이터 적재 시 성능 저하가 발생할 수 있습니다. 적재 후에 인덱스를 생성하거나, 인덱스 재구성을 고려할 필요가 있습니다.
- `Vertica`와 같은 분석 DB는 대량 데이터를 처리할 때 최적화된 방법을 제공하므로, 해당 DB의 특성을 이해하고 적절한 성능 튜닝을 해야 합니다.

### 7. 데이터 무결성 검증

- 데이터가 정확하게 변환되고 옮겨졌는지 검증하는 절차가 필수적입니다. 데이터 손실이나 변형이 없는지 검증하기 위한 로그, 검증 쿼리, 샘플링 등을 활용해 데이터를 확인해야 합니다.

### 8. 특정 함수 및 기능의 차이

- DB별로 지원하는 함수가 다를 수 있으므로, 변환 중에 사용한 SQL 함수가 대상 DB에서도 동일하게 동작하는지 확인해야 합니다. `Vertica`와 같은 경우 `REGEXP_REPLACE`와 같은 함수가 없기 때문에, 이를 대체할 방안을 미리 준비해야 합니다.
